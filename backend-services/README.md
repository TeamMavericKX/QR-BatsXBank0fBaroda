# Backend Services (Python Flask/Java Spring Boot)

## Overview

The backend services form the core of the QR-BATS system, handling transaction processing, zero-trust policy enforcement, biometric verification, and integration with existing banking infrastructure. These services are designed to be scalable, secure, and highly available, leveraging modern microservices architecture principles.

## Key Functionalities

- API Gateway: Acts as the single entry point for all mobile application requests, providing routing, load balancing, and initial security checks.
- Transaction Service: Manages the lifecycle of high-value transactions, from initiation to completion, including coordination with other backend components.
- Zero-Trust Policy Enforcement Point (PEP): Enforces access policies based on verified identity, device posture, and session context for every transaction.
- Zero-Trust Policy Decision Point (PDP): Evaluates access requests against predefined policies (leveraging Open Policy Agent - OPA) to grant or deny access.
- PQC Verification Service: Verifies the Post-Quantum Cryptography (PQC) signatures generated by the user's device against the PQC Public Key Infrastructure.
- Biometric Verification Service: Authenticates user biometrics (facial and voice) against encrypted biometric templates, ensuring liveness and legitimacy.
- Fraud Detection System Integration: Interfaces with an integrated Fraud Detection System (e.g., IBM X-Force) to identify and mitigate suspicious activities.
- Core Banking System Integration: Seamlessly integrates with the Bank of Baroda's existing core banking system for real-time transaction updates and account management.

## Implementation Details

The backend will be developed using either Python (Flask/FastAPI) or Java (Spring Boot), depending on the specific requirements for performance, ecosystem, and existing infrastructure. The services will be deployed as microservices, enabling independent development, deployment, and scaling.

Key considerations include robust API design, secure communication (mTLS), efficient data handling, and comprehensive logging and monitoring. The Zero-Trust components (PEP and PDP) will be custom-built to ensure tight integration with the QR-BATS security model.

## Technologies Used

- Backend Frameworks: Python (Flask/FastAPI), Java (Spring Boot)
- Database: PostgreSQL (for transaction logs, user profiles), Redis (for session management, caching)
- Cloud Platform: AWS (EC2, Lambda, RDS, S3, KMS, CloudWatch, API Gateway, Route 53)
- Zero-Trust Enforcement: Custom PEP/PDP services, Open Policy Agent (OPA)
- Security: HashiCorp Vault (secret management), Prometheus/Grafana (monitoring)

## API Endpoints

### Tentatively Planned API Endpoints

Here's a tentative list of API endpoints for the QR-BATS backend services, outlining their structure and purpose. These endpoints are designed to facilitate secure and efficient communication between the mobile application and the backend, adhering to RESTful principles where applicable.

### 1. User Authentication and Session Management

- **Endpoint:** `/api/v1/auth/login`
  - **Method:** `POST`
  - **Purpose:** Authenticates a user and establishes a secure session. This initial login might leverage traditional credentials or FIDO passkeys.
  - **Request Body:** `{ "username": "string", "password": "string" }` or FIDO assertion data.
  - **Response:** `{ "token": "jwt_token", "user_id": "string", "session_id": "string" }`

- **Endpoint:** `/api/v1/auth/logout`
  - **Method:** `POST`
  - **Purpose:** Terminates an active user session.
  - **Request Body:** `{ "session_id": "string" }`
  - **Response:** `{ "status": "success", "message": "Logged out successfully" }`

### 2. Transaction Initiation and Biometric Attestation

- **Endpoint:** `/api/v2/transactions/initiate`
  - **Method:** `POST`
  - **Purpose:** Initiates a high-value transaction, requiring initial transaction details and preparing for biometric attestation.
  - **Request Body:** `{ "user_id": "string", "transaction_details": { /* details like amount, recipient, type */ } }`
  - **Response:** `{ "transaction_id": "string", "challenge": "string", "biometric_type_required": "facial" | "voice" }`

- **Endpoint:** `/api/v2/transactions/{transaction_id}/attest/biometric`
  - **Method:** `POST`
  - **Purpose:** Receives biometric attestation data from the mobile app for a specific transaction. This endpoint triggers the Biometric Verification Service and PQC Verification Service.
  - **Request Body:** `{ "biometric_data": "base64_encoded_biometric_sample", "pqc_signature": "base64_encoded_pqc_signature", "challenge_response": "string" }`
  - **Response:** `{ "status": "pending" | "approved" | "denied", "message": "string" }`

### 3. Transaction Status and History

- **Endpoint:** `/api/v1/transactions/{transaction_id}/status`
  - **Method:** `GET`
  - **Purpose:** Retrieves the current status of a specific transaction.
  - **Response:** `{ "transaction_id": "string", "status": "pending" | "approved" | "denied" | "completed", "timestamp": "datetime", "details": { /* current transaction details */ } }`

- **Endpoint:** `/api/v1/users/{user_id}/transactions`
  - **Method:** `GET`
  - **Purpose:** Retrieves a list of past transactions for a given user.
  - **Query Parameters:** `?status=approved`, `?start_date=YYYY-MM-DD`, `?end_date=YYYY-MM-DD`
  - **Response:** `[ { /* transaction object */ }, ... ]`

### 4. System Health and Monitoring (Internal/Admin APIs)

- **Endpoint:** `/api/v1/health`
  - **Method:** `GET`
  - **Purpose:** Provides a basic health check of the API Gateway and core services.
  - **Response:** `{ "status": "healthy", "timestamp": "datetime" }`

- **Endpoint:** `/api/v1/metrics`
  - **Method:** `GET`
  - **Purpose:** Provides performance metrics and operational data for monitoring (e.g., transaction throughput, error rates).
  - **Response:** `{ "cpu_usage": "float", "memory_usage": "float", "transaction_rate": "int", "error_rate": "float" }`

### 5. Zero-Trust Policy Management (Admin APIs)

- **Endpoint:** `/api/v1/policies`
  - **Method:** `GET` / `POST` / `PUT` / `DELETE`
  - **Purpose:** Manages Zero-Trust policies within the OPA engine. (Requires administrative privileges).
  - **Request/Response:** Varies based on operation (e.g., policy definition in Rego language).

---

Note: This is a tentative list and may be refined based on further requirements analysis, security considerations, and implementation feasibility. All API endpoints will be secured using appropriate authentication and authorization mechanisms (e.g., JWT tokens, mTLS) and will be subject to strict input validation and error handling.
